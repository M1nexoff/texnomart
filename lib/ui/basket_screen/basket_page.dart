import 'package:flutter/material.dart';import 'package:flutter_bloc/flutter_bloc.dart';import 'package:iconsax/iconsax.dart';import 'package:provider/provider.dart';import 'package:texnomart/presentation/theme/light_colors.dart';import 'package:texnomart/presentation/theme/my_images.dart';import 'package:texnomart/presentation/theme/ui_components.dart';import '../../data/model/data/special_product_item_data.dart';import '../../presentation/basket/basket_bloc.dart';import '../main_screen/cart.dart';import 'basket.dart';class BasketPage extends StatefulWidget {  const BasketPage({Key? key}) : super(key: key);  @override  State<BasketPage> createState() => _BasketPageState();}class _BasketPageState extends State<BasketPage> {  final _bloc = BasketBloc();  List<SpecialItemData> data = [];  @override  void initState() {    _bloc.add(GetAllProductsFromBasketEvent());    super.initState();  }  @override  void didChangeDependencies() {    // TODO: implement didChangeDependencies    super.didChangeDependencies();    setState(() {      _bloc.add(GetAllProductsFromBasketEvent());    });  }  @override  Widget build(BuildContext context) {    final cart = Provider.of<CartProvider>(context);    var all = 0;    data.map((e)=>(int.tryParse(e.salePrice.toString())??1) * (int.tryParse(e.count.toString())??1)).forEach((e)=>all += e);    return BlocProvider.value(      value: _bloc,      child: BlocConsumer<BasketBloc, BasketState>(        listener: (context, state) {          if (state is GetAllProductsFromBasketState) {            setState(() {              data = List.from(state.data);            });          }        },        builder: (context, state) {          return Scaffold(            backgroundColor: Colors.white,            body: SafeArea(              child: Column(                children: [                  Expanded(                    child: Padding(                      padding: const EdgeInsets.all(10),                      child: Builder(                        builder: (context) {                          if (state is GetAllProductsFromBasketState) {                            return state.data.isNotEmpty?ListView.separated(                              itemCount: data.length,                              itemBuilder: (context, index) {                                return BasketItem(                                  product: data[index],                                  onDelete: () {                                    // Удаление продукта из корзины                                    _bloc.add(DeleteProductFromBasketEvent(                                        product: data[index]));                                    cart.removeItem();                                  },                                  onChange: (){                                    setState(() {                                    });                                  },                                );                              },                              separatorBuilder: (BuildContext context, int index) {                                return _buildCustomThicknessDivider();                              },                            ) : const Column(                              mainAxisAlignment: MainAxisAlignment.center,                              children: [                                Icon(Iconsax.shopping_cart, size: 56,),                                SizedBox(height: 24,),                                NormalText(text: "Savatda hali hech narsa yo'q", fontSize: 20,)                              ],                            );                          } else {                            return const Center(                              child: CircularProgressIndicator(),                            );                          }                        },                      ),                    ),                  ),                  const SizedBox(height: 10),                  Row(                    mainAxisAlignment: MainAxisAlignment.spaceBetween,                    children: [                      Padding(                        padding: EdgeInsets.only(left: 12.0),                        child: Text(                          "Barchasi: " + all.toString().formatNumber() + " som",                          style: TextStyle(                            fontFamily: 'PaynetB',                            fontWeight: FontWeight.w700,                            fontSize: 20,                          ),                        ),                      ),                      Padding(                        padding: EdgeInsets.only(right: 8.0),                      ),                    ],                  ),                  Padding(                    padding: const EdgeInsets.symmetric(horizontal: 8.0),                    child: Container(                      height: 50,                      width: MediaQuery.of(context).size.width,                      decoration: ShapeDecoration(                        color: const Color(0xFFffc300),                        shape: RoundedRectangleBorder(                          borderRadius: BorderRadius.circular(10),                        ),                      ),                      child: Padding(                        padding: const EdgeInsets.symmetric(                          vertical: 15,                        ),                        child: InkWell(                          onTap: () async {},                          child: const Text(                            'Buyurtma qilish',                            textAlign: TextAlign.center,                            style: TextStyle(                              fontFamily: 'PaynetB',                              color: Colors.black,                              fontSize: 18,                              fontWeight: FontWeight.w400,                              height: 0,                            ),                          ),                        ),                      ),                    ),                  ),                  const SizedBox(height: 10),                  Padding(                    padding: const EdgeInsets.symmetric(horizontal: 8.0),                    child: Container(                      width: MediaQuery.of(context).size.width,                      decoration: ShapeDecoration(                        color: Colors.black,                        shape: RoundedRectangleBorder(                          borderRadius: BorderRadius.circular(10),                        ),                      ),                      child: Padding(                        padding: const EdgeInsets.symmetric(vertical: 15),                        child: InkWell(                          onTap: () async {                            // Handle Tozalash button tap                            _bloc.add(DeleteBasket());                          },                          child: const Text(                            'Tozalash',                            textAlign: TextAlign.center,                            style: TextStyle(                              fontFamily: 'PaynetB',                              color: Colors.white,                              fontSize: 18,                              fontWeight: FontWeight.w400,                              height: 0,                            ),                          ),                        ),                      ),                    ),                  ),                ],              ),            ),          );        },      ),    );  }  Widget _buildCustomThicknessDivider() {    return Padding(      padding: const EdgeInsets.symmetric(horizontal: 16.0),      child: Container(        height: 1,        color: LightColors.primary2,      ),    );  }}